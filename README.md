# jenkinstesting

## What is this?
This is a jenkins file and startup scripts for a jenkins pipeline that does the following:
* Download the used environment and software (with couple of exceptions. See Requirements)
    * Get docker containers using docker
    * git clone tools that are in github
* Setup the environment so that Selenium testing can start
    * Start containers and do any setup that is needed
    * Start and setup proxy
* Execute Selenium tests
    * Use ant to build and execute existing junit tests
* Record the traffic generated by the tests
* Get and parse a har-file generated by the proxy so that it only contains wanted traffic
    * Custo java program
* Turn har file to sequence file used in Defensics
    * Use development version of Defensics due to having to use commandline
* Start Defensics testing based on the har

## But why?
This pipeline is intented to demonstrate how you can potentially add fuzz testing to your existing Build -> Test -> Deploy pipeline where you test your web application using Selenium. Basically if you can somehow get all the traffic from your existing tests adding fuzztesting with a smart fuzzing framework like Defensics is trivial. 

## Environment
### Test targets
* [Mutillidae](https://www.owasp.org/index.php/OWASP_Mutillidae_2_Project). Site hosted in docker container. Is intentionally vulnerable and the vulnerability can be modified. 
* [Swagger pet shop api](https://petstore.swagger.io/). Api hosted in a docker container. 

### Proxy
* [Browsermob proxy](https://github.com/lightbody/browsermob-proxy). Used in recording the traffic generated by the Selenium tests
* Harparser. Software hosted in harparser repository. A java script that gets the har-file from browsermob and removes all traffic that doesn't come from or go to testing environment

### Tests
* Junit tests that utilize Selenium. Hosted in Seleniumtesting repository
* [ASC](https://github.com/ouspg/ASC) to check api coverage of Selenium tests
* [Synopsys Defensics](https://www.synopsys.com/software-integrity/security-testing/fuzz-testing.html).


## Requirements
Jenkinsfile will fetch the above components but it requires the following in order to work:

* java 8
* firefox
* firefox driver accessible from command line
* docker
* jenkins
* xvfb 
* xvfb jenkins plugin
* Defensics
* ant
* git
* python3
* pip3

Other:
* Ports 8080,8181 and 81 open. Petshop will be hosted in localhost:8080 and mutillidae at localhost:81/mutillidae
* Make sure jenkis has the permission to use docker. One way is to add jenkins to the docker group. ``` sudo usermod -aG docker jenkins ``` If you use this it will give jenkins root level privileges. Please check https://docs.docker.com/install/linux/linux-postinstall/ for more details
* Current iteration works only with a version of Defensics that supports sequence file creation through commandline. At the time of writing only such version was a development version.


## How to use this?
* Install jenkins
* Create a pipeline project
* Do one of the following
1. Executing from github
    * Go to pipeline tab and change definition to "Pipeline script from SCM"
    * Change SCM to Git and add this repos url to the Repository url field
    * If you have all the requirements job should run with the parameters set in git
2. Executing from jenkinsfile
    * Alternatively you can clone this repo and execute the jenkinsfile. This way you can modify the jenkinsfile and other contents to fit your system
    * This is the preferred method

* Save and Build

# Future work
* Improve readme and commenting
* Conditional steps to jenkins
    * No need to redownload everything everytime
    * Can skip test and certain setups
* More configurability
    * More flexibility on what tests to run in Defensics and with what parameters
* Make browsermod download use github api
* Consider getting all the requirements in setup phase
* Consider moving all the execution to a docker container. 
* Currently jenkins has the same privileges as docker. Go over the security risks of this and try to migitate them.
* Move to ouspg repository




